# Create Pull Request for Issue

Create a pull request from the current branch, linking it to a GitHub issue.

## Usage

```
/ke:pr [issue-number] [--reviewer <user>] [--draft]
```

### Options
- `--reviewer <user>` - Request review from user(s) (comma-separated for multiple)
- `--draft` - Create as draft PR

### Examples
```
/ke:pr 42
/ke:pr 42 --reviewer johndoe
/ke:pr 42 --reviewer johndoe,janedoe --draft
```

## Instructions

You are tasked with creating a pull request that addresses a GitHub issue.

### Step 0: Determine the Issue Number

- If `$ARGUMENTS` contains an issue number, use it
- Otherwise, infer from:
  1. Current branch name (e.g., `issue-42` â†’ #42)
  2. Recent commits referencing issues
  3. Conversation context
- If no issue found, ask the user which issue this PR addresses

### Step 1: Verify Branch State

Check the current branch is ready for a PR:

```bash
# Get current branch
git branch --show-current

# Check for uncommitted changes
git status --porcelain

# Check if branch has commits ahead of main
git rev-list --count main..HEAD
```

**If uncommitted changes exist:**
- Ask user: "There are uncommitted changes. Commit them first? (yes/no)"
- If yes, create a commit with message: `Fix #<issue-number>: <description>`

**If no commits ahead of main:**
- Inform user: "No commits to create PR from. Make changes first."
- Exit

### Step 2: Push Branch to Remote

```bash
git push -u origin <branch-name>
```

If push fails, inform user of the error.

### Step 3: Fetch Issue Details

```bash
gh issue view <issue-number> --json title,body,labels,milestone
```

Use the issue title and body to inform the PR description.

### Step 4: Create Pull Request

```bash
gh pr create \
  --title "Fix #<issue-number>: <issue-title-or-summary>" \
  --body "$(cat <<'EOF'
## Summary
Fixes #<issue-number>

[Brief description of changes]

## Changes Made
- [Change 1]
- [Change 2]

## Testing
- [ ] Tested locally
- [ ] All tests pass

---
*Generated by Claude Code*
EOF
)" \
  [--reviewer "<user1>,<user2>"] \
  [--draft]
```

### Step 5: Report the PR

After creating the PR, tell the user:
- PR number and title
- URL to the PR
- Reviewers (if set)
- Draft status (if draft)

Example:
```
Created PR #89: Fix #42: Add dark mode toggle
- URL: https://github.com/owner/repo/pull/89
- Reviewers: @johndoe
- Status: Ready for review

The PR will automatically close issue #42 when merged.
```

### Step 6: Offer Next Steps

```
Next steps:
- View PR: <url>
- Add more commits: make changes and `git push`
- When approved: `/ke:close 42` or merge via GitHub
```

### Important

- Ensure the PR description includes `Fixes #<issue-number>` or `Closes #<issue-number>` for auto-linking
- Do NOT merge the PR (that's a separate action)
- If working from a worktree, ensure you're pushing the correct branch
- If PR already exists for this branch, inform the user and show the existing PR URL
